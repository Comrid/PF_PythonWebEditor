<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pathfinder Python Web Editor</title>

    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/popover.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/new.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tutorial.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/challenge.css') }}">

    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- GridStack.js 12.2.2 -->
    <link href="https://cdn.jsdelivr.net/npm/gridstack@12.2.2/dist/gridstack.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/gridstack@12.2.2/dist/gridstack-all.js"></script>

    <!-- marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- ì‚¬ìš©ì ì •ë³´ -->
    <script type="application/json" id="user-data">
        {
            "id": {{ user_id|tojson|safe }},
            "username": {{ username|tojson|safe }},
            "email": {{ email|tojson|safe }},
            "role": {{ role|tojson|safe }}
        }
    </script>
    <script>
        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        const userDataElement = document.getElementById('user-data');
        if (userDataElement) {
            window.currentUser = JSON.parse(userDataElement.textContent);
        }
    </script>
</head>
<body>
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    <section class="popover-container">
        <!-- Add Widget Popover -->
        <div class="popover add-widget-popover" id="addWidgetPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-layer-group"></i> Add Widget</h5>
                    <button class="popover-close" id="closeAddWidgetPopover"><i class="fas fa-times"></i></button>
                </div>
                <div class="popover-body">
                    <div class="widget-picker" id="addWidgetGrid"></div>
                </div>
            </div>
        </div>
        <!-- Editor Settings Popover -->
        <div class="popover" id="editorSettingsPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-cog"></i> ì—ë””í„° ì„¤ì •</h5>
                    <button class="popover-close" id="closeEditorSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body">
                    <div class="setting-item">
                        <label class="setting-label" for="increaseFontSize">Font Size</label>
                        <div class="font-size-controls">
                            <button class="size-btn size-btn-minus" id="decreaseFontSize">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="current-size" id="currentFontSize">16</span>
                            <button class="size-btn size-btn-plus" id="increaseFontSize">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="wordWrapToggle">Word Wrap</label>
                        <div class="toggle-controls">
                            <button class="toggle-btn" id="wordWrapToggle">
                                <div class="toggle-slider">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <span class="toggle-label" id="wordWrapLabel">Off</span>
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="minimapToggle">Minimap</label>
                        <div class="toggle-controls">
                            <button class="toggle-btn" id="minimapToggle">
                                <div class="toggle-slider">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <span class="toggle-label" id="minimapLabel">Off</span>
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="geminiApiKey">Gemini API Key</label>
                        <div class="api-key-controls">
                            <input type="password" class="form-input" id="geminiApiKey" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                            <button class="btn btn-small btn-success" id="saveApiKeyBtn">
                                <i class="fas fa-save"></i> ì €ì¥
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="loadExamDropdown">Example</label>
                        <div class="dropdown-controls">
                            <button class="dropdown-btn" id="loadExamDropdown">
                                <span class="dropdown-text" id="loadExamText">Select Exam</span>
                                <i class="fas fa-chevron-down dropdown-icon"></i>
                            </button>
                            <div class="dropdown-menu" id="loadExamMenu">
                                <div class="dropdown-item" data-value="Empty">Empty</div>
                                <div class="dropdown-item" data-value="Default">Default</div>
                                <div class="dropdown-item" data-value="EditorExam">Editor Exam</div>
                                <div class="dropdown-item" data-value="CameraExam">Camera Exam</div>
                                <div class="dropdown-item" data-value="MotorExam">Motor Exam</div>
                                <div class="dropdown-item" data-value="UltrasonicExam">Ultrasonic Exam</div>
                                <div class="dropdown-item" data-value="MediapipeExam">Mediapipe Exam</div>
                                <div class="dropdown-item" data-value="SliderExam">Slider Exam</div>
                                <div class="dropdown-item" data-value="LaneDetectionExam">Lane Detection</div>
                                <div class="dropdown-item" data-value="ObstacleAvoidanceExam">Obstacle Avoidance</div>
                                <div class="dropdown-item" data-value="PIDControlExam">PID Control</div>

                                <div class="dropdown-item" data-value="exam1">getCode1</div>
                                <div class="dropdown-item" data-value="exam2">getCode2</div>
                                <div class="dropdown-item" data-value="exam3">getCode3</div>
                                <div class="dropdown-item" data-value="exam4">getCode4</div>
                                <div class="dropdown-item" data-value="exam5">getCode5</div>
                                <div class="dropdown-item" data-value="exam6">getCode6</div>
                                <div class="dropdown-item" data-value="exam7">getCode7</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Webcam Settings Popover (empty body as requested) -->
        <div class="popover" id="webcamSettingsPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-cog"></i> ì›¹ìº  ì„¤ì •</h5>
                    <button class="popover-close" id="closeWebcamSettingsPopover">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body" id="webcamSettingsBody">
                    <!-- Injected dynamically -->
                </div>
            </div>
        </div>
        <!-- Code File Popover (Save + Load) -->
        <div class="popover save-load-popover" id="codeFilePopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-file-code"></i> ì½”ë“œ íŒŒì¼ ê´€ë¦¬</h5>
                    <button class="popover-close" id="closeCodeFilePopover">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body">
                    <!-- Save Section -->
                    <div class="setting-item">
                        <label class="setting-label">ì½”ë“œ ì €ì¥</label>
                        <div class="api-key-controls">
                            <div class="input-dropdown-container">
                                <input type="text" class="form-input" id="saveCodeFilename" placeholder="íŒŒì¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: my_code.py)" />
                                <button class="dropdown-toggle-btn" id="filenameDropdownToggle" title="ê¸°ì¡´ íŒŒì¼ ëª©ë¡">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu filename-dropdown-menu" id="filenameDropdownMenu">
                                    <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                                </div>
                            </div>
                            <button class="btn btn-small btn-success" id="confirmSaveCodeBtn">
                                <i class="fas fa-save"></i> ì €ì¥
                            </button>
                        </div>
                    </div>

                    <!-- Load Section -->
                    <div class="setting-item">
                        <label class="setting-label">ì½”ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</label>
                        <div id="loadCodeFileList" style="max-height: 200px; overflow-y: auto;">
                            <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <h1>
                <img src="{{ url_for('static', filename='img/app-logo.png') }}" class="app-logo" alt="App Logo" id="headerLogo" style="cursor: pointer;">
                Pathfinder Python Web Editor
            </h1>
            <div class="status-info">
                <div class="user-info" id="userInfo">
                    <i class="fas fa-user"></i>
                    <span id="userDisplayName">{{ username }}</span>
                    <span id="userRole" class="user-role">{{ role }}</span>
                </div>
                <div class="status-item">
                    <div class="status-dot error" id="statusDot"></div>
                    <span id="statusText">Disconnected</span>
                </div>
                <div class="robot-selector" id="robotSelector">
                    <div class="robot-dropdown">
                        <button class="robot-dropdown-btn" id="robotDropdownBtn">
                            <i class="fas fa-robot"></i>
                            <span class="robot-dropdown-text" id="robotDropdownText">ë¡œë´‡ ì„ íƒ</span>
                            <i class="fas fa-chevron-down robot-dropdown-icon"></i>
                        </button>
                        <div class="robot-dropdown-menu" id="robotDropdownMenu">
                            <div class="robot-dropdown-item" data-value="">
                                <span class="robot-item-name">ë¡œë´‡ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            </div>
                            <!-- ë¡œë´‡ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </div>
                    </div>
                    <div class="robot-status-indicator" id="robotStatusIndicator">
                        <div class="status-dot offline" id="robotStatusDot"></div>
                        <span id="robotStatusText">ë¡œë´‡ ì—†ìŒ</span>
                    </div>
                </div>
                <!-- CPU ëª¨ë‹ˆí„°ëŠ” ì„œë²„-í´ë¼ì´ì–¸íŠ¸ í†µì‹  êµ¬ì¶• í›„ ì¶”ê°€ ì˜ˆì • -->
            </div>
            <div class="header-controls">
                <button class="btn btn-primary" id="addWidgetBtn">
                    <i class="fas fa-plus"></i>
                    Add Widget
                </button>
                <button class="btn btn-secondary" id="widgetSettingsBtn">
                    <i class="fas fa-cog"></i>
                    Settings
                </button>
                <button class="btn btn-warning" id="clearAllWidgetsBtn">
                    <i class="fas fa-trash"></i>
                    Clear All
                </button>

            </div>
        </header>

        <!-- GridStack Container -->
        <section class="gridstack-section">
            <div class="grid-stack" id="mainGridStack">
                <!-- Injected dynamically -->
            </div>
        </section>

        <!-- AI Chat Button (Fixed Position) -->
        <div class="ai-chat-button" id="aiChatButton">
            <img src="{{ url_for('static', filename='img/app-logo.png') }}" alt="AI Chat" class="ai-chat-icon">
            <div class="ai-chat-close" id="aiChatClose">Ã—</div>
        </div>

        <!-- AI Chat Popover -->
        <div class="popover ai-chat-popover" id="aiChatPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-robot"></i> AI Assistant</h5>
                    <button class="popover-close" id="closeAiChatPopover">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body">
                    <!-- AI ì±„íŒ… ë‚´ìš©ì´ ì—¬ê¸°ì— ë“¤ì–´ê°ˆ ì˜ˆì • -->
                    <div class="ai-chat-placeholder">
                        <i class="fas fa-comments"></i>
                        <p>AIì™€ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/util.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/editor.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/widget.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/llm.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/new.js') }}" defer></script> <!-- ì„ì‹œ íŒŒì¼ -->
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/tutorial.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/challenge.js') }}" defer></script>

    <script src="{{ url_for('static', filename='js/socket-handler.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/popover.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/hand_gesture.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/action.js') }}" defer></script>
    <!-- CPU ì‚¬ìš©ëŸ‰ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì„œë²„-í´ë¼ì´ì–¸íŠ¸ í†µì‹  êµ¬ì¶• í›„ ì¶”ê°€ ì˜ˆì • -->
    
    <script>
        // í—¤ë” ë¡œê³  í´ë¦­ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            // ì‚¬ìš©ì ì •ë³´ ì¶œë ¥ (ë””ë²„ê¹…ìš©)
            console.log('í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì:', window.currentUser);
            
            const headerLogo = document.getElementById('headerLogo');
            if (headerLogo) {
                headerLogo.addEventListener('click', function() {
                    window.location.href = '/';
                });
            }
            
            // ë¡œë´‡ ì„ íƒê¸° ì´ˆê¸°í™”
            initializeRobotSelector();
            
            // ë¡œë´‡ ëª©ë¡ ë¡œë“œ
            loadRobotList();
        });
        
        // ë¡œë´‡ ì„ íƒê¸° ìƒíƒœ
        let editorSelectedRobot = null;
        let editorRobotList = [];

        // ë¡œë´‡ ì„ íƒê¸° ì´ˆê¸°í™”
        function initializeRobotSelector() {
            console.log('ë¡œë´‡ ì„ íƒê¸° ì´ˆê¸°í™” ì‹œì‘');
            
            const robotDropdownBtn = document.getElementById('robotDropdownBtn');
            const robotDropdownMenu = document.getElementById('robotDropdownMenu');
            
            if (!robotDropdownBtn || !robotDropdownMenu) {
                console.error('ë¡œë´‡ ì„ íƒê¸° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë“œë¡­ë‹¤ìš´ í† ê¸€ ì´ë²¤íŠ¸
            robotDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleRobotDropdown();
            });
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', (e) => {
                if (!robotDropdownBtn.contains(e.target) && !robotDropdownMenu.contains(e.target)) {
                    closeRobotDropdown();
                }
            });
            
            console.log('ë¡œë´‡ ì„ íƒê¸° ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ë¡œë´‡ ëª©ë¡ ë¡œë“œ
        async function loadRobotList() {
            console.log('ğŸ”„ ë¡œë´‡ ëª©ë¡ ë¡œë“œ ì‹œì‘');
            
            try {
                const response = await fetch('/api/robots');
                console.log('ğŸ“¡ API ì‘ë‹µ ë°›ìŒ:', response);
                
                // ë””ë²„ê¹…ì„ ìœ„í•´ ì „ì—­ ë³€ìˆ˜ë¡œ ë…¸ì¶œ
                window.lastApiResponse = response;
                console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:', response.status);
                console.log('ğŸ“¡ API ì‘ë‹µ OK:', response.ok);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“¡ JSON íŒŒì‹± ì™„ë£Œ:', data);
                    
                    editorRobotList = data;
                    console.log('âœ… ë¡œë´‡ ëª©ë¡ ë¡œë“œ ì„±ê³µ:', editorRobotList);
                    console.log('ğŸ“‹ ë¡œë´‡ ê°œìˆ˜:', editorRobotList.length);
                    
                    updateRobotDropdown();
                } else {
                    const errorText = await response.text();
                    console.error('âŒ ë¡œë´‡ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', response.status, errorText);
                    editorRobotList = [];
                    updateRobotDropdown();
                }
            } catch (error) {
                console.error('âŒ ë¡œë´‡ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                editorRobotList = [];
                updateRobotDropdown();
            }
            
            console.log('ğŸ”„ ë¡œë´‡ ëª©ë¡ ë¡œë“œ ì™„ë£Œ');
        }

        // ë¡œë´‡ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateRobotDropdown() {
            console.log('ğŸ”„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì‹œì‘');
            console.log('ğŸ“‹ í˜„ì¬ editorRobotList:', editorRobotList);
            console.log('ğŸ“‹ editorRobotList.length:', editorRobotList.length);
            
            const robotDropdownMenu = document.getElementById('robotDropdownMenu');
            if (!robotDropdownMenu) {
                console.error('âŒ robotDropdownMenu ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ“‹ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìš”ì†Œ ì°¾ìŒ:', robotDropdownMenu);
            
            // ê¸°ì¡´ ì˜µì…˜ ëª¨ë‘ ì œê±°
            robotDropdownMenu.innerHTML = '';
            console.log('ğŸ“‹ ê¸°ì¡´ ì˜µì…˜ ì œê±° ì™„ë£Œ');
            
            if (editorRobotList.length === 0) {
                console.log('âš ï¸ ë¡œë´‡ ëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                const item = document.createElement('div');
                item.className = 'robot-dropdown-item disabled';
                item.innerHTML = `
                    <span class="robot-item-name">í• ë‹¹ëœ ë¡œë´‡ì´ ì—†ìŠµë‹ˆë‹¤</span>
                    <span class="robot-item-status">ë¡œë´‡ì„ ë“±ë¡í•˜ì„¸ìš”</span>
                `;
                robotDropdownMenu.appendChild(item);
                console.log('ğŸ“‹ ë¹ˆ ëª©ë¡ ë©”ì‹œì§€ ì¶”ê°€ ì™„ë£Œ');
            } else {
                console.log(`ğŸ“‹ ${editorRobotList.length}ê°œì˜ ë¡œë´‡ì„ ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€`);
                
                editorRobotList.forEach((robot, index) => {
                    console.log(`ğŸ“‹ ë¡œë´‡ ${index + 1} ì¶”ê°€:`, robot);
                    
                    const item = document.createElement('div');
                    item.className = 'robot-dropdown-item';
                    item.setAttribute('data-robot-id', robot.robot_id);
                    
                    const status = robot.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
                    const statusClass = robot.online ? 'online' : 'offline';
                    
                    item.innerHTML = `
                        <span class="robot-item-name">${robot.name}</span>
                        <span class="robot-item-status ${statusClass}">${status}</span>
                    `;
                    
                    item.addEventListener('click', () => selectRobot(robot));
                    robotDropdownMenu.appendChild(item);
                    
                    console.log(`ğŸ“‹ ë¡œë´‡ ${index + 1} DOMì— ì¶”ê°€ ì™„ë£Œ`);
                });
            }
            
            console.log('âœ… ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            console.log('ğŸ“‹ ìµœì¢… ë“œë¡­ë‹¤ìš´ ë‚´ìš©:', robotDropdownMenu.innerHTML);
        }

        // ë¡œë´‡ ì„ íƒ
        async function selectRobot(robot) {
            console.log('ğŸ¤– ë¡œë´‡ ì„ íƒ:', robot);
            
            try {
                // 1. ë¡œë´‡ í• ë‹¹
                const assignSuccess = await assignRobot(robot.robot_id);
                
                if (assignSuccess) {
                    // 2. UI ì—…ë°ì´íŠ¸
                    editorSelectedRobot = robot;
                    updateRobotSelectionUI(robot);
                    updateRobotStatus();
                    
                    console.log('âœ… ë¡œë´‡ ì„ íƒ ì™„ë£Œ:', robot.name);
                } else {
                    console.error('âŒ ë¡œë´‡ í• ë‹¹ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('âŒ ë¡œë´‡ ì„ íƒ ì˜¤ë¥˜:', error);
            } finally {
                closeRobotDropdown();
            }
        }

        // ë¡œë´‡ í• ë‹¹
        async function assignRobot(robotId) {
            console.log('ğŸ”— ë¡œë´‡ í• ë‹¹ ì‹œë„:', robotId);
            
            try {
                const response = await fetch(`/api/robots/${robotId}/assign`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… ë¡œë´‡ í• ë‹¹ ì„±ê³µ:', result.message);
                    return true;
                } else {
                    const error = await response.json();
                    console.error('âŒ ë¡œë´‡ í• ë‹¹ ì‹¤íŒ¨:', error.error);
                    return false;
                }
            } catch (error) {
                console.error('âŒ ë¡œë´‡ í• ë‹¹ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ë¡œë´‡ ì„ íƒ UI ì—…ë°ì´íŠ¸
        function updateRobotSelectionUI(robot) {
            // ë“œë¡­ë‹¤ìš´ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const robotDropdownText = document.getElementById('robotDropdownText');
            if (robotDropdownText) {
                robotDropdownText.textContent = robot.name;
            }
            
            // ì„ íƒëœ ì•„ì´í…œ í‘œì‹œ
            const items = document.querySelectorAll('.robot-dropdown-item');
            items.forEach(item => {
                item.classList.remove('selected');
                if (item.getAttribute('data-robot-id') === robot.robot_id) {
                    item.classList.add('selected');
                }
            });
        }

        // ë“œë¡­ë‹¤ìš´ í† ê¸€
        function toggleRobotDropdown() {
            const robotDropdownMenu = document.getElementById('robotDropdownMenu');
            if (robotDropdownMenu) {
                robotDropdownMenu.classList.toggle('show');
                console.log('ë“œë¡­ë‹¤ìš´ í† ê¸€');
            }
        }

        // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        function closeRobotDropdown() {
            const robotDropdownMenu = document.getElementById('robotDropdownMenu');
            if (robotDropdownMenu) {
                robotDropdownMenu.classList.remove('show');
            }
        }

        // ë””ë²„ê¹…ìš© í•¨ìˆ˜ë“¤
        function debugRobotList() {
            console.log('=== ë¡œë´‡ ëª©ë¡ ë””ë²„ê¹… ===');
            console.log('editorRobotList:', editorRobotList);
            console.log('editorRobotList.length:', editorRobotList.length);
            console.log('editorSelectedRobot:', editorSelectedRobot);
            console.log('window.lastApiResponse:', window.lastApiResponse);
            console.log('========================');
        }

        function debugApiResponse() {
            if (window.lastApiResponse) {
                console.log('API ì‘ë‹µ ìƒíƒœ:', window.lastApiResponse.status);
                console.log('API ì‘ë‹µ OK:', window.lastApiResponse.ok);
            } else {
                console.log('API ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤. loadRobotList()ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.');
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.debugRobotList = debugRobotList;
        window.debugApiResponse = debugApiResponse;
        window.loadRobotList = loadRobotList;

        // ë¡œë´‡ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateRobotStatus() {
            const robotStatusDot = document.getElementById('robotStatusDot');
            const robotStatusText = document.getElementById('robotStatusText');
            
            if (editorSelectedRobot) {
                if (robotStatusDot) {
                    robotStatusDot.className = `status-dot ${editorSelectedRobot.online ? 'online' : 'offline'}`;
                }
                if (robotStatusText) {
                    const status = editorSelectedRobot.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
                    const assigned = editorSelectedRobot.assigned ? ' (í• ë‹¹ë¨)' : ' (ë¯¸í• ë‹¹)';
                    robotStatusText.textContent = `${status}${assigned}`;
                }
            } else {
                if (robotStatusDot) {
                    robotStatusDot.className = 'status-dot offline';
                }
                if (robotStatusText) {
                    robotStatusText.textContent = 'ë¡œë´‡ ì—†ìŒ';
                }
            }
        }


        // ë¡œë´‡ ì„ íƒê¸° ì´ˆê¸°í™”ëŠ” ìœ„ì—ì„œ ì²˜ë¦¬ë¨
    </script>
</body>
</html>
