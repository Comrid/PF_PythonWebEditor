<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pathfinder Python Web Editor</title>

    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/popover.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/new.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/first.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tutorial.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/challenge.css') }}">

    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- GridStack.js 12.2.2 -->
    <link href="https://cdn.jsdelivr.net/npm/gridstack@12.2.2/dist/gridstack.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/gridstack@12.2.2/dist/gridstack-all.js"></script>

    <!-- marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    <section class="popover-container">
        <!-- Add Widget Popover -->
        <div class="popover add-widget-popover" id="addWidgetPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-layer-group"></i> Add Widget</h5>
                    <button class="popover-close" id="closeAddWidgetPopover"><i class="fas fa-times"></i></button>
                </div>
                <div class="popover-body">
                    <div class="widget-picker" id="addWidgetGrid"></div>
                </div>
            </div>
        </div>
        <!-- Editor Settings Popover -->
        <div class="popover" id="editorSettingsPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-cog"></i> 에디터 설정</h5>
                    <button class="popover-close" id="closeEditorSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body">
                    <div class="setting-item">
                        <label class="setting-label" for="increaseFontSize">Font Size</label>
                        <div class="font-size-controls">
                            <button class="size-btn size-btn-minus" id="decreaseFontSize">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="current-size" id="currentFontSize">16</span>
                            <button class="size-btn size-btn-plus" id="increaseFontSize">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="wordWrapToggle">Word Wrap</label>
                        <div class="toggle-controls">
                            <button class="toggle-btn" id="wordWrapToggle">
                                <div class="toggle-slider">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <span class="toggle-label" id="wordWrapLabel">Off</span>
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="minimapToggle">Minimap</label>
                        <div class="toggle-controls">
                            <button class="toggle-btn" id="minimapToggle">
                                <div class="toggle-slider">
                                    <div class="toggle-indicator"></div>
                                </div>
                                <span class="toggle-label" id="minimapLabel">Off</span>
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="geminiApiKey">Gemini API Key</label>
                        <div class="api-key-controls">
                            <input type="password" class="form-input" id="geminiApiKey" placeholder="API 키를 입력하세요" />
                            <button class="btn btn-small btn-success" id="saveApiKeyBtn">
                                <i class="fas fa-save"></i> 저장
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label" for="loadExamDropdown">Example</label>
                        <div class="dropdown-controls">
                            <button class="dropdown-btn" id="loadExamDropdown">
                                <span class="dropdown-text" id="loadExamText">Select Exam</span>
                                <i class="fas fa-chevron-down dropdown-icon"></i>
                            </button>
                            <div class="dropdown-menu" id="loadExamMenu">
                                <div class="dropdown-item" data-value="Empty">Empty</div>
                                <div class="dropdown-item" data-value="Default">Default</div>
                                <div class="dropdown-item" data-value="EditorExam">Editor Exam</div>
                                <div class="dropdown-item" data-value="CameraExam">Camera Exam</div>
                                <div class="dropdown-item" data-value="MotorExam">Motor Exam</div>
                                <div class="dropdown-item" data-value="UltrasonicExam">Ultrasonic Exam</div>
                                <div class="dropdown-item" data-value="MediapipeExam">Mediapipe Exam</div>
                                <div class="dropdown-item" data-value="SliderExam">Slider Exam</div>
                                <div class="dropdown-item" data-value="LaneDetectionExam">Lane Detection</div>
                                <div class="dropdown-item" data-value="ObstacleAvoidanceExam">Obstacle Avoidance</div>
                                <div class="dropdown-item" data-value="PIDControlExam">PID Control</div>

                                <div class="dropdown-item" data-value="exam1">getCode1</div>
                                <div class="dropdown-item" data-value="exam2">getCode2</div>
                                <div class="dropdown-item" data-value="exam3">getCode3</div>
                                <div class="dropdown-item" data-value="exam4">getCode4</div>
                                <div class="dropdown-item" data-value="exam5">getCode5</div>
                                <div class="dropdown-item" data-value="exam6">getCode6</div>
                                <div class="dropdown-item" data-value="exam7">getCode7</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Webcam Settings Popover (empty body as requested) -->
        <div class="popover" id="webcamSettingsPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-cog"></i> 웹캠 설정</h5>
                    <button class="popover-close" id="closeWebcamSettingsPopover">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body" id="webcamSettingsBody">
                    <!-- Injected dynamically -->
                </div>
            </div>
        </div>
        <!-- Code File Popover (Save + Load) -->
        <div class="popover save-load-popover" id="codeFilePopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-file-code"></i> 코드 파일 관리</h5>
                    <button class="popover-close" id="closeCodeFilePopover">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body">
                    <!-- Save Section -->
                    <div class="setting-item">
                        <label class="setting-label">코드 저장</label>
                        <div class="api-key-controls">
                            <div class="input-dropdown-container">
                                <input type="text" class="form-input" id="saveCodeFilename" placeholder="파일명을 입력하세요 (예: my_code.py)" />
                                <button class="dropdown-toggle-btn" id="filenameDropdownToggle" title="기존 파일 목록">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="dropdown-menu filename-dropdown-menu" id="filenameDropdownMenu">
                                    <!-- 동적으로 채워짐 -->
                                </div>
                            </div>
                            <button class="btn btn-small btn-success" id="confirmSaveCodeBtn">
                                <i class="fas fa-save"></i> 저장
                            </button>
                        </div>
                    </div>

                    <!-- Load Section -->
                    <div class="setting-item">
                        <label class="setting-label">코드 불러오기</label>
                        <div id="loadCodeFileList" style="max-height: 200px; overflow-y: auto;">
                            <!-- 동적으로 채워짐 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <header class="header">
            <h1>
                <img src="{{ url_for('static', filename='img/app-logo.png') }}" class="app-logo" alt="App Logo" id="headerLogo" style="cursor: pointer;">
                Pathfinder Python Web Editor
            </h1>
            <div class="status-info">
                <div class="status-item">
                    <div class="status-dot error" id="statusDot"></div>
                    <span id="statusText">Disconnected</span>
                </div>
                <div class="cpu-monitor" id="cpuMonitor">
                    <div class="cpu-display" id="cpuDisplay">
                        <i class="fas fa-microchip"></i>
                        <span id="cpuPercent">0%</span>
                    </div>
                    <div class="cpu-details" id="cpuDetails">
                        <div class="cpu-details-header">
                            <span>CPU 사용량 상세</span>
                            <button class="cpu-close-btn" id="cpuCloseBtn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="cpu-cores" id="cpuCores">
                            <!-- 개별 CPU 코어 정보가 여기에 동적으로 추가됨 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-controls">
                <button class="btn btn-primary" id="addWidgetBtn">
                    <i class="fas fa-plus"></i>
                    Add Widget
                </button>
                <button class="btn btn-secondary" id="widgetSettingsBtn">
                    <i class="fas fa-cog"></i>
                    Settings
                </button>
                <button class="btn btn-warning" id="clearAllWidgetsBtn">
                    <i class="fas fa-trash"></i>
                    Clear All
                </button>

            </div>
        </header>

        <!-- GridStack Container -->
        <section class="gridstack-section">
            <div class="grid-stack" id="mainGridStack">
                <!-- Injected dynamically -->
            </div>
        </section>

        <!-- AI Chat Button (Fixed Position) -->
        <div class="ai-chat-button" id="aiChatButton">
            <img src="{{ url_for('static', filename='img/app-logo.png') }}" alt="AI Chat" class="ai-chat-icon">
            <div class="ai-chat-close" id="aiChatClose">×</div>
        </div>

        <!-- AI Chat Popover -->
        <div class="popover ai-chat-popover" id="aiChatPopover">
            <div class="popover-content">
                <div class="popover-header">
                    <h5><i class="fas fa-robot"></i> AI Assistant</h5>
                    <button class="popover-close" id="closeAiChatPopover">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="popover-body">
                    <!-- AI 채팅 내용이 여기에 들어갈 예정 -->
                    <div class="ai-chat-placeholder">
                        <i class="fas fa-comments"></i>
                        <p>AI와 대화를 시작하세요</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/util.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/editor.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/widget.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/llm.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/new.js') }}" defer></script> <!-- 임시 파일 -->
    <script src="{{ url_for('static', filename='js/first.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/tutorial.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/challenge.js') }}" defer></script>

    <script src="{{ url_for('static', filename='js/socket-handler.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/popover.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/hand_gesture.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/action.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/cpu.js') }}" defer></script>
    
    <script>
        // 헤더 로고 클릭 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            const headerLogo = document.getElementById('headerLogo');
            if (headerLogo) {
                headerLogo.addEventListener('click', function() {
                    window.location.href = '/';
                });
            }
        });
    </script>
</body>
</html>
