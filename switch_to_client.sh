#!/bin/bash
# μ¤ν¬λ¦½νΈ μ‹¤ν–‰ μ¤‘ μ¤λ¥κ°€ λ°μƒν•λ©΄ μ¦‰μ‹ μ¤‘λ‹¨ν•©λ‹λ‹¤.
set -e

echo "λ„¤νΈμ›ν¬ λ¨λ“λ¥Ό APμ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ „ν™ν•©λ‹λ‹¤..."

# --- 1λ‹¨κ³„: AP κ΄€λ ¨ μ„λΉ„μ¤ μ¤‘μ§€ λ° λΉ„ν™μ„±ν™” ---
echo "AP κ΄€λ ¨ μ„λΉ„μ¤(hostapd, dnsmasq)λ¥Ό μ¤‘μ§€ν•κ³  λΉ„ν™μ„±ν™”ν•©λ‹λ‹¤."
systemctl stop hostapd || true
systemctl stop dnsmasq || true
systemctl disable hostapd || true
systemctl disable dnsmasq || true

# --- 2λ‹¨κ³„: λ„¤νΈμ›ν¬ μ„¤μ •μ„ ν΄λΌμ΄μ–ΈνΈ λ¨λ“λ΅ λ³€κ²½ ---
echo "λ„¤νΈμ›ν¬ μ„¤μ •μ„ DHCP ν΄λΌμ΄μ–ΈνΈ λ¨λ“λ΅ λ³µμ›ν•©λ‹λ‹¤."
# AP λ¨λ“μ© κ³ μ • IP μ„¤μ •μ„ μ κ±°ν•κ³ , ν‘μ¤€ ν΄λΌμ΄μ–ΈνΈ μ„¤μ •μΌλ΅ λ®μ–΄μ”λ‹λ‹¤.
tee "/etc/dhcpcd.conf" > /dev/null << EOC
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
EOC

# --- 3λ‹¨κ³„: μ„λΉ„μ¤ μ „ν™ ---
echo "λ¶€ν… μ‹ μ‹¤ν–‰λ  μ„λΉ„μ¤λ¥Ό μ „ν™ν•©λ‹λ‹¤ (wifi_setup -> webeditor)."
# ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ Wi-Fi μ„¤μ • μ•± μ„λΉ„μ¤λ¥Ό λΉ„ν™μ„±ν™”ν•©λ‹λ‹¤.
systemctl disable wifi_setup.service
# λ‹¤μ λ¶€ν… μ‹ λ©”μΈ μ›Ή μ—λ””ν„° μ„λΉ„μ¤κ°€ μ‹¤ν–‰λλ„λ΅ ν™μ„±ν™”ν•©λ‹λ‹¤.
systemctl enable webeditor.service

# --- 4λ‹¨κ³„: μ¬λ¶€ν…μΌλ΅ λ¨λ“  λ³€κ²½μ‚¬ν•­ μ μ© ---
echo "π‰ μ„¤μ • μ™„λ£! ν΄λΌμ΄μ–ΈνΈ λ¨λ“λ΅ μ „ν™ν•κΈ° μ„ν•΄ μ‹μ¤ν…μ„ μ¬λ¶€ν…ν•©λ‹λ‹¤."
reboot